# ============================================
# CONFIGURATION GÃ‰NÃ‰RIQUE (tout projet)
# ============================================

# Configuration Workflow (orchestration)
workflow:
  # Phases par dÃ©faut du cycle de dÃ©veloppement
  default-flow:
    - brainstorm
    - plan
    - execute-plan
    - code-review
    - finish-branch

  # Phases nÃ©cessitant validation utilisateur
  checkpoints:
    - plan
    - code-review

  # Seuil de complexitÃ© pour mode autopilot (0-10)
  autopilot-threshold: 3

  # Mode d'exÃ©cution par dÃ©faut (standard, subagent)
  default-execution-mode: standard

  # Proposer worktree automatiquement si pas sur branche feature
  auto-suggest-worktree: true

# Comportement du brainstorming
brainstorming:
  # Proposer de rÃ©cupÃ©rer le contexte Jira si un ID est dÃ©tectÃ©
  auto_detect_jira_ids: true

  # Profondeur de gÃ©nÃ©ration (epic â†’ story â†’ task â†’ subtask)
  default_depth: full

# Configuration Quality Gates pour /finish-branch (gÃ©nÃ©rique)
finish-branch:
  # Gates par type de projet (auto-dÃ©tectÃ©)
  project-types:
    php-simple:
      # DÃ©tection : composer.json sans Makefile
      gates:
        - composer test
        - vendor/bin/phpstan analyse
    node:
      # DÃ©tection : package.json prÃ©sent
      gates:
        - npm test
        - npm run lint
    python:
      # DÃ©tection : pyproject.toml ou requirements.txt
      gates:
        - pytest
        - ruff check

# Configuration Ralph Loop
ralph:
  # Nombre max d'iterations avant arret automatique
  max_iterations: 20

  # Promise de completion (Claude doit output cette phrase pour terminer)
  completion_promise: "ALL_STORIES_PASS"

# Configuration Slack
slack:
  # Channel pour les demandes de code review
  code_review_channel: "#code-reviews"

  # Messages alÃ©atoires pour les demandes de CR
  cr_messages:
    - template: |
        ğŸ‘€ Qui veut review ma MR ?
        {title}
        â†’ {url}
    - template: |
        ğŸ¯ CR disponible !
        MR !{mr_id} - {title}
        Premier arrivÃ©, premier servi ğŸƒ
        â†’ {url}
    - template: |
        ğŸš€ Pipeline vert, MR prÃªte !
        âœ¨ {title}
        ğŸ”— {url}
        Merci d'avance ! ğŸ™
    - template: |
        â˜• Une petite review ?
        MR !{mr_id} - {title}
        â†’ {url}

  # Blagues optionnelles (20% de chance d'apparaÃ®tre)
  jokes:
    - "Je promets qu'il n'y a que 2 fichiers changÃ©s... par commit ğŸ˜…"
    - "J'ai Ã©crit des tests, je le jure ğŸ¤"
    - "Pas de force push cette fois, promis"
    - "Le code est auto-documentÃ© (dit-il, confiant)"
    - "Fonctionne sur ma machine â„¢ï¸"

# ============================================
# CONFIGURATION OBAT (ignorÃ©e hors contexte)
# ============================================
# Active uniquement si : git remote -v | grep -q "gitlab.obat.fr"

obat:
  # Pattern de dÃ©tection du contexte Obat
  detection: gitlab.obat.fr

  # Configuration Jira Obat
  jira:
    default_project: OBAT
    board_id: 42
    # Composants disponibles (favoris)
    preferred_components:
      - backend
      - frontend
      - mobile
      - infrastructure
    # Labels frÃ©quents
    common_labels:
      - feature
      - bugfix
      - tech-debt
      - security

  # Surcharge des quality gates pour projets PHP Obat
  finish-branch:
    project-types:
      php-backend:
        # DÃ©tection : composer.json + Makefile prÃ©sents
        gates:
          - make test
          - make phpstan
          - make fix-cs
          - make rector
          - make deptrac

    # Gates additionnelles pour --strict (analyses approfondies)
    strict-checks:
      - skill: obat/contract-check
        condition: contracts-dir-exists
      - skill: obat/impact-analysis
        condition: contracts-dir-exists

  # Conventions de nommage des worktrees
  worktree:
    naming: "{type}/{PROJECT}-{ID}[-desc]"
    types:
      - feat
      - tech
      - fix
      - hotfix

  # Configuration ADR (Architecture Decision Records)
  adr:
    output_dir: docs/plans
    final_dir: blueprint/adr
    format: obat
